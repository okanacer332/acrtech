---
title: "إعادة تدوير المنسوجات - ERP دولي: هندسة Multi-Tenant و RBAC"
category: "SaaS Architecture"
description: "مراجعة فنية لنظام الإدارة متعدد المستأجرين والقائم على الأدوار الذي تم تطويره باستخدام Next.js و Spring Boot للعمليات النسيجية العالمية. تفاصيل الوصول أدناه."
date: "2025-12-12"
image: "/portfolio/22.png"
---

# نظام الإدارة المتكامل متعدد المستأجرين (Multi-Tenant) والقائم على الأدوار (RBAC) في سلسلة توريد المنسوجات العالمية

**المشروع:** AJ International ERP

**رابط الوصول:** [app-tekstil.acrtech.com.tr](https://app-tekstil.acrtech.com.tr)

**نوع الوثيقة:** مقال عن الهندسة الفنية وتحليل النظام

## ملخص (Abstract)

يفحص هذا المقال نظام تخطيط موارد المؤسسات (ERP) القائم على السحابة الذي تم تطويره لعمليات AJ International، والذي يدير العمليات التجارية الموزعة جغرافيًا (تركيا، روسيا، دبي) من خلال برنامج أساسي واحد.

تتناول الدراسة هندسة "Multi-Tenant" (متعدد المستأجرين) التي تم إنشاؤها باستخدام الاستخدام الهجين لتقنيات **Next.js 14** و **Spring Boot** و **MongoDB** وآلية RBAC (التحكم في الوصول القائم على الأدوار) التي تعمل بنشاط في النظام بتفاصيل فنية. النظام هو حل برمجي تم التحقق منه يعمل في بيئة حية ويضمن عزل البيانات مع الحفاظ على قدرات الإدارة المركزية.

## 1. المقدمة

يتطلب قطاع النسيج نموذج بيانات معقدًا بسبب هيكل منتجاته المتغير (اللون، الحجم، نوع القماش) والعمليات اللوجستية عبر الحدود.

اعتمد مشروع AJ International بنية حديثة قائمة على الخدمات، غير متجانسة، لإدارة هذا التعقيد. يجمع النظام بين العمليات في تركيا وروسيا ودبي، ولكل منها قواعدها القانونية والتجارية الخاصة، في بنية تحتية منفصلة منطقيًا ولكنها تعمل فعليًا على مجموعة قاعدة بيانات واحدة.

## 2. هندسة النظام ومكدس التكنولوجيا

تم هيكلة المشروع بحيث تعمل طبقات الواجهة الأمامية والخلفية بشكل مستقل تمامًا، وفقًا لمبدأ "فصل الاهتمامات" (Separation of Concerns).

### 2.1. هندسة الواجهة الأمامية (طبقة العميل)

تم بناء تجربة المستخدم على بنية **Next.js 14 (App Router)** نظرًا لقدرتها على العرض من جانب الخادم (SSR) وتوافقها مع تحسين محركات البحث (SEO).

* **مكتبة المكونات:** تم تطوير مكونات واجهة مستخدم قابلة لإعادة الاستخدام وخفيفة الوزن تتوافق مع مبادئ التصميم الذري باستخدام Shadcn/ui و TailwindCSS.

* **إدارة الحالة:** تتم إدارة بيانات النماذج المعقدة ومعلومات جلسة المستخدم في الحالة العامة باستخدام مكتبة **Zustand**.

* **جلب البيانات:** تم تحسين مزامنة البيانات بين الخادم والعميل، وتقليل طلبات الشبكة باستخدام أنماط SWR أو TanStack Query.

### 2.2. هندسة الواجهة الخلفية (طبقة الخادم)

يعمل منطق العمل (Business Logic) على **Spring Boot 3.x**، وهو معيار نظام Java البيئي للمؤسسات.

* **قاعدة البيانات:** **MongoDB (NoSQL)**. استلزم الهيكل الهرمي والمتغير لمنتجات المنسوجات (على سبيل المثال، منتج يحتوي على N من متغيرات الألوان وكل متغير يحتوي على M من مخزونات الحجم) هيكلاً موجهًا للمستندات بدلاً من قواعد البيانات العلائقية.

* **بوابة واجهة برمجة التطبيقات (API Gateway):** تتم تلبية جميع الطلبات من خلال نقاط النهاية (endpoints) المصممة وفقًا لمعايير RESTful API.

## 3. هندسة الأمان والتحكم في الوصول

طبقة أمان النظام هي هيكل نشط حاليًا يغطي ليس فقط المصادقة ولكن أيضًا التفويض التفصيلي.

### 3.1. التحكم في الوصول القائم على الأدوار (RBAC)

في النظام، يصل المستخدمون إلى موارد محددة وفقًا لأدوارهم المعينة. يعمل هذا الهيكل في سلسلة تصفية أمان الربيع (Spring Security Filter Chain) بالمنطق التالي:

> Permission(u) = Union( Roles(u) -> Permissions(r) )

يتم تطبيق التسلسل الهرمي التالي بنشاط في النظام:

* **المسؤول الفائق (Root):** سلطة إدارة جميع المستأجرين (البلدان) والتكوينات.

* **مسؤول البلد (Tenant Admin):** يدير المستخدمين والمخزونات والشؤون المالية في بلده فقط (على سبيل المثال، TR أو RU أو DU). لا يمكنه رؤية بيانات البلدان الأخرى.

* **المستخدم التشغيلي:** لديه سلطة إدخال البيانات وعرضها فقط؛ سلطة الحذف أو التكوين مقيدة.

### 3.2. المصادقة (JWT & HttpOnly)

يتمتع النظام ببنية "Stateless" (عديمة الحالة).

1.  عندما يقوم المستخدم بتسجيل الدخول، يقوم الخادم بإنشاء **JWT (JSON Web Token)** موقع.

2.  يتم تخزين هذا الرمز المميز في **HttpOnly Cookie** لا يمكن الوصول إليه بواسطة JavaScript من جانب العميل. توفر هذه الطريقة حماية كاملة ضد هجمات XSS (البرمجة النصية عبر المواقع).

## 4. تعدد المستأجرين وعزل البيانات

يستخدم النظام استراتيجية **"العمود المميز"** (Discriminator Column)، وليس "قاعدة بيانات لكل مخطط" (Database-per-Schema)، حيث تخدم نسخة برمجية واحدة مؤسسات متعددة.

* **سياق المستأجر:** يتم التقاط كل طلب HTTP بواسطة معترض (Interceptor).

* **تصفية البيانات:** تتم قراءة `tenant_id` (على سبيل المثال، tr، ru، du) من رأس الطلب (Header) أو ملف تعريف المستخدم الذي قام بتسجيل الدخول.

* **استعلام MongoDB:** تضيف الواجهة الخلفية تلقائيًا المعيار `{ tenant: "current_tenant" }` إلى كل استعلام يذهب إلى قاعدة البيانات. وبهذه الطريقة، أصبح من المستحيل تقنيًا على مستخدم من روسيا الوصول إلى بيانات تركيا عن طريق التلاعب بواجهة برمجة التطبيقات.

## 5. تفاصيل الوحدات والوظائف

يتكون نظام AJ International من الوحدات الرئيسية التالية التي تدير عمليات النسيج من البداية إلى النهاية:

### 5.1. لوحة القيادة ولوحة الإدارة

يتم تشكيل الشاشة التي يواجهها المستخدم أولاً ديناميكيًا وفقًا لمستوى التفويض.

* **بطاقات KPI:** يتم حساب مقاييس مثل إجمالي المبيعات، والطلبات النشطة، ومستوى المخزون الحرج على الفور.

* **التحليل البياني:** يتم تصور اتجاهات المبيعات وتوزيع المخزون.

### 5.2. إدارة المنتجات والمخزون (PIM & WMS)

تغطي هذه الوحدة، وهي قلب قطاع النسيج، إدارة المتغيرات حتى أدق التفاصيل.

* **مصفوفة المتغيرات:** تتم إدارة التصنيفات الفرعية (SKU) مثل اللون، والحجم، ونوع القماش تحت منتج رئيسي (Parent Product).

* **حركات المخزون:** يتم تسجيل معاملات الدخول والخروج والتحويل والإرجاع. يتم تتبع المنتج الموجود في أي مستودع (مستودع TR، مستودع RU) وكميته على الفور.

### 5.3. الحساب الجاري وعلاقات العملاء (CRM)

مصمم لعمليات B2B.

* **بطاقات العملاء:** محفظة عملاء كل بلد معزولة.

* **تتبع الرصيد:** يتم تنفيذ حالة ديون/ائتمان العملاء ومعاملات المقاصة المستندة إلى الطلبات من خلال النظام.

### 5.4. إدارة المبيعات والطلبات

يغطي العملية من لحظة استلام الطلب حتى التسليم.

* **إنشاء الطلب:** نموذج طلب يعمل بمنطق السلة، بما في ذلك التسعير الديناميكي.

* **إدارة الحالة:** تتبع سير العمل من خلال حالات "قيد الانتظار"، "قيد التحضير"، "تم الشحن"، "تم التسليم".

## 6. عرض حي والتحقق التشغيلي

يمكن التحقق من هيكل "Multi-Tenant" وقدرات RBAC للنظام في البيئة الحية أدناه. تثبت تفاصيل الوصول هذه قدرة النظام على العزل وقابلية تشغيل الوحدات.

**رابط المشروع:** [https://app-tekstil.acrtech.com.tr](https://app-tekstil.acrtech.com.tr)

حسابات المسؤول المحددة لاختبار النظام بامتيازات معزولة هي:

| منطقة التشغيل | اسم المستخدم | كلمة المرور | نطاق الوصول |
| :--- | :--- | :--- | :--- |
| **عملية تركيا** | `admin.tr` | `admin` | منتجات TR والحسابات الجارية فقط. |
| **عملية روسيا** | `admin.ru` | `admin` | لوجستيات ومخزونات RU فقط. |
| **عملية دبي** | `admin.du` | `admin` | بيانات سوق الشرق الأوسط. |

> **ملاحظة:** عند تسجيل الدخول مع كل مستخدم، على الرغم من أن الوحدات في القائمة اليسرى تبدو متشابهة، سترى أن البيانات بداخلها (قائمة المنتجات، قائمة العملاء) مختلفة تمامًا.

## 7. الخاتمة

مشروع AJ International هو حل SaaS حديث بهيكل RBAC لا يساوم على الأمان، وواجهة أمامية Next.js عالية الأداء، وهندسة قاعدة بيانات MongoDB مرنة.

يخدم النظام حاليًا بنشاط ليس فقط كبيئة لتسجيل البيانات، ولكن كمنصة متكاملة يتم فيها اتخاذ القرارات التشغيلية، وتوفير عزل البيانات عبر المناطق بيقين رياضي.