---
title: "FidanYS: Архитектура сельскохозяйственной ERP с защитой от инфляции и поддержкой мультиарендности"
category: "SaaS & AgTech Architecture"
description: "Технический обзор облачной системы управления, разработанной на Next.js 15, Spring Boot и MongoDB для процессов производства саженцев, интегрированной с инфляционным учетом. Данные для доступа ниже."
date: "2025-12-14"
image: "/portfolio/fidan.png"
author: "Системный Архитектор"
---

# Интегрированное планирование ресурсов для современного сельского хозяйства: Технический анализ FidanYS

**Проект:** Система управления питомником (FidanYS)

**URL доступа:** [app-fidanys.acrtech.com.tr](https://app-fidanys.acrtech.com.tr)

**Тип документа:** Анализ технической архитектуры и введение в систему

## Аннотация (Abstract)

Этот технический обзор охватывает проект **FidanYS**, разработанный для управления сложными структурами инвентаризации (живой инвентарь) и финансовыми процессами предприятий, занимающихся производством и торговлей саженцами.

Система решает проблему отслеживания «живых продуктов», где стандартное программное обеспечение ERP оказывается недостаточным, используя **Spring Boot** и гибкую структуру схем **MongoDB**; она предлагает высокопроизводительный пользовательский интерфейс с **Next.js 15**. Самой отличительной чертой проекта является модуль финансовой аналитики, который защищает предприятия от эрозии капитала, применяя **Инфляционный учет** через интеграцию с ЦБ (TCMB).

## 1. Введение и Проблемное пространство

Сельскохозяйственное производство, особенно выращивание саженцев, не может управляться с помощью стандартной логики инвентаризации электронной коммерции или розничной торговли. Основными препятствиями для цифровизации в этом секторе являются:

1.  **Составная идентификация продукта:** Саженец не может быть определен одним SKU (артикулом). Комбинация из 6 различных параметров, таких как вид, сорт, подвой, размер, возраст и состояние горшка, составляет идентификацию продукта.
2.  **Производственные процессы:** Расходы (труд, удобрения), понесенные в течение 1-3 лет от семени до формирования саженца, должны быть правильно отражены в конечной стоимости продукта.
3.  **Экономическая неопределенность:** В условиях высокой инфляции продажа продукта, произведенного несколько месяцев назад, по его исторической стоимости приводит к убыткам для предприятия.

FidanYS — это решение SaaS (Программное обеспечение как услуга), разработанное на принципах «Domain-Driven Design» (Проектирование на основе предметной области) для решения этих проблем.

## 2. Технологический стек и Системная архитектура

Система структурирована в формате **Full-Stack** и **Monorepo** (Клиент и Сервер разделены, но интегрированы) для удовлетворения требований масштабируемости и безопасности.

### 2.1. Архитектура Frontend (Клиент)

Пользовательский интерфейс работает на **Next.js 15 (App Router)**, самой современной версии веб-стандартов.

* **Типобезопасность:** Проект разработан на 100% с использованием **TypeScript**, что минимизирует ошибки времени выполнения.
* **Библиотека UI:** Используется **Material UI (MUI v7)** для создания отзывчивого, доступного интерфейса с поддержкой тем (Темный/Светлый режим).
* **Состояние и Кэш:** Для управления данными используется библиотека **SWR (Stale-While-Revalidate)**. Эта стратегия гарантирует, что пользователь видит данные мгновенно (кэш), пока в фоновом режиме проверяется их актуальность.
* **Валидация форм:** Сложный ввод данных проверяется как на стороне клиента, так и на стороне сервера с помощью схем **React Hook Form** и **Zod**.

### 2.2. Архитектура Backend (Сервер)

Слой бизнес-логики построен на **Spring Boot 3.x (Java 17+)**, стандарте корпоративной надежности.

* **Выбор базы данных: MongoDB (NoSQL).**
    * *Почему NoSQL?* Атрибуты саженцев изменчивы. Вместо жесткой табличной структуры SQL, характеристики продукта хранятся как динамические и вложенные объекты с использованием документоориентированной структуры MongoDB.
* **Стратегия API:** Создана архитектура API, ориентированная на ресурсы и полностью соответствующая стандартам **RESTful**.
* **Интеграция внешних сервисов:** Ежедневные данные об инфляции и курсы валют автоматически поступают в систему через безопасное соединение с сервисом API EVDS ЦБ.

## 3. Архитектура мультиарендности (Multi-Tenancy)

FidanYS работает по модели «Программное обеспечение как услуга», где один экземпляр приложения обслуживает несколько компаний.

* **Изоляция арендаторов:** Каждый критический документ (Заказ, Склад, Текущий счет и т.д.) в базе данных имеет поле `tenantId`.
* **Автоматическая фильтрация:** Перехватчики (interceptors), работающие на уровне Spring Data/Security в слое бэкенда, определяют, от какой компании (Арендатора) поступает запрос.
    * Считывается информация `tenantId` внутри `AuthenticationService` и JWT.
    * Критерий `{ tenantId: "active_tenant" }` автоматически добавляется ко всем запросам к базе данных.
    * Эта архитектура делает математически невозможным просмотр данных Компании А Компанией Б.

## 4. Критические функциональные модули

Основные модули, отличающие систему от конкурентов:

### 4.1. Умное управление складом и вариациями
Продукты в системе — это не просто строки. Она работает с логикой «Семейство продуктов» и «Вариации».
* **Матрица вариаций:** Когда пользователи выбирают вид «Грецкий орех», например, система автоматически представляет возможные сорта (Chandler, Fernor) и размеры в виде матрицы.
* **Отслеживание по местоположению:** Мгновенно отслеживается, на каком участке или в каком складе находится саженец.

### 4.2. Инфляционный учет и Финансовая аналитика
Это самый технический и стратегический слой проекта.
* **Реальная оценка:** `InflationService` рассчитывает текущую «Реальную» стоимость расходов, сделанных в прошлом.
* **Анализ затрат:** При определении цены продажи саженца система предлагает «Цену защиты капитала», добавляя к себестоимости не только цену покупки в счете-фактуре, но и уровень инфляции, произошедший с той даты по настоящее время.

### 4.3. Производственные партии (Batches)
Отслеживание ведется на основе «Партий» (Batches) в соответствии с природой сельскохозяйственного производства.
* `ProductionBatch` создается, когда сеется семя.
* Все расходы на удобрения и орошение для этой партии собираются в `CostPool` (Пул затрат).
* Когда наступает время сбора урожая, общие затраты в пуле делятся на количество произведенных саженцев для расчета **Реальной удельной себестоимости**.

## 5. Безопасность и Авторизация

Безопасность приложения обеспечивается по принципу «Defense in Depth» (Глубокая защита).

* **Аутентификация:** Аутентификация без сохранения состояния (stateless) на основе JWT (JSON Web Token).
* **Шифрование:** Пароли пользователей хранятся в хешированном виде с использованием алгоритма **BCrypt**.
* **RBAC (Ролевое управление доступом):**
    * `ADMIN`: Имеет все полномочия.
    * `SALES`: Может видеть только заказы и текущие счета, не видит затраты.
    * `WAREHOUSE`: Может выполнять только вход-выход со склада, не видит денежные значения.
* **Единая сессия:** Когда пользователь входит с другого устройства, его старая сессия завершается в целях безопасности (механизм `forceLogin`).

## 6. Живая система и Доступ

Можно протестировать архитектуру системы, структуру данных и возможности финансовой отчетности в живой среде.

| URL доступа | Имя пользователя | Пароль | Примечание |
| :--- | :--- | :--- | :--- |
| **[https://app-fidanys.acrtech.com.tr](https://app-fidanys.acrtech.com.tr/auth/sign-in)** | `admin` | `admin` | Демо-аккаунт с полными правами. |

*Транзакции, совершенные в демо-среде, считаются тестовыми данными и могут периодически сбрасываться.*

## 7. Заключение

FidanYS предлагает точечное решение потребности сельскохозяйственного сектора в «цифровой трансформации», сочетая стабильность экосистемы Java с современностью Next.js. Особенно благодаря модулю **Инфляционного учета**, она вышла за рамки просто программы отслеживания склада и превратилась в систему стратегической поддержки принятия решений для владельцев бизнеса.